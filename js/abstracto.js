const questions = [
    {
        "question": "",
        "image": "https://i.imgur.com/5n12mql.png",
        "options": [
            "A",
            "B",
            "C",
            "D"
        ],
        "correct": "C",
        "subject": "Abstracto",
        "id": "A003",
        "flag": false
    },
    {
        "question": "",
        "image": "https://i.imgur.com/61BHhRD.png",
        "options": [
            "A",
            "B",
            "C",
            "D"
        ],
        "correct": "C",
        "subject": "Abstracto",
        "id": "A004",
        "flag": false
    },
    {
        "question": "",
        "image": "https://i.imgur.com/0W9R3nt.png",
        "options": [
            "A",
            "B",
            "C",
            "D"
        ],
        "correct": "D",
        "subject": "Abstracto",
        "id": "A005",
        "flag": false
    },
    {
        "question": "",
        "image": "https://i.imgur.com/gX66MsC.png",
        "options": [
            "A",
            "B",
            "C",
            "D"
        ],
        "correct": "B",
        "subject": "Abstracto",
        "id": "A006",
        "flag": false
    },
    {
        "question": "",
        "image": "https://i.imgur.com/C33QUIE.png",
        "options": [
            "A",
            "B",
            "C",
            "D"
        ],
        "correct": "A",
        "subject": "Abstracto",
        "id": "A007",
        "flag": false
    },
    {
        "question": "",
        "image": "https://i.imgur.com/Pv44qHN.png",
        "options": [
            "A",
            "B",
            "C",
            "D"
        ],
        "correct": "A",
        "subject": "Abstracto",
        "id": "A008",
        "flag": false
    },
    {
        "question": "",
        "image": "https://i.imgur.com/WAom1dG.png",
        "options": [
            "A",
            "B",
            "C",
            "D"
        ],
        "correct": "C",
        "subject": "Abstracto",
        "id": "A009",
        "flag": false
    },
    {
        "question": "",
        "image": "https://i.imgur.com/0zFpO3i.png",
        "options": [
            "A",
            "B",
            "C",
            "D"
        ],
        "correct": "D",
        "subject": "Abstracto",
        "id": "A010",
        "flag": false
    },
    {
        "question": "",
        "image": "https://i.imgur.com/CBKHxPf.png",
        "options": [
            "A",
            "B",
            "C",
            "D"
        ],
        "correct": "C",
        "subject": "Abstracto",
        "id": "A011",
        "flag": false
    },
    {
        "question": "https://i.imgur.com/Zquibpz.png",
        "image": "",
        "options": [
            "A",
            "B",
            "C",
            "D"
        ],
        "correct": "D",
        "subject": "Abstracto",
        "id": "A012",
        "flag": false
    },
    {
        "question": "",
        "image": "https://i.imgur.com/bnOVRMk.png",
        "options": [
            "A",
            "B",
            "C",
            "D"
        ],
        "correct": "D",
        "subject": "Abstracto",
        "id": "A013",
        "flag": false
    },
    {
        "question": "",
        "image": "https://i.imgur.com/f49whok.png",
        "options": [
            "A",
            "B",
            "C",
            "D"


        ],
        "correct": "B",
        "subject": "Abstracto",
        "id": "A014",
        "flag": false
    },
    {
        "question": "",
        "image": "https://i.imgur.com/mwGXZxZ.png",
        "options": [
            "A",
            "B",
            "C",
            "D"
        ],
        "correct": "C",
        "subject": "Abstracto",
        "id": "A015",
        "flag": false
    },
    {
        "question": "",
        "image": "https://i.imgur.com/SUiJFeF.png",
        "options": [
            "A",
            "B",
            "C",
            "D"
        ],
        "correct": "A",
        "subject": "Abstracto",
        "id": "A016",
        "flag": false
    },
    {
        "question": "",
        "image": "https://i.imgur.com/ZrubPuv.png",
        "options": [
            "A",
            "B",
            "C",
            "D"
        ],
        "correct": "D",
        "subject": "Abstracto",
        "id": "A017",
        "flag": false
    },
    {
        "question": "",
        "image": "https://i.imgur.com/cAYGC7p.png",
        "options": [
            "10",
            "11",
            "12",
            "13"
        ],
        "correct": "11",
        "subject": "Abstracto",
        "id": "A018",
        "flag": false
    },
    {
        "question": "",
        "image": "https://i.imgur.com/JCTwwCR.png",
        "options": [
            "11",
            "10",
            "9",
            "8"
        ],
        "correct": "11",
        "subject": "Abstracto",
        "id": "A019",
        "flag": false
    },
    {
        "question": "",
        "image": "https://i.imgur.com/axYdLSw.png",
        "options": [
            "Rojo: dentro; Verde: fuera",
            "Rojo: fuera; Verde: fuera",
            "Rojo: dentro; Verde: dentro",
            "Rojo fuera; Verde: dentro"
        ],
        "correct": "Rojo fuera; Verde: dentro",
        "subject": "Abstracto",
        "id": "A020",
        "flag": false
    },
    {
        "question": "",
        "image": "https://i.imgur.com/dWl2mlH.png",
        "options": [
            "Rojo: dentro; Verde: fuera",
            "Rojo: dentro; Verde: dentro",
            "Rojo: fuera; Verde: fuera",
            "Rojo fuera; Verde: dentro"
        ],
        "correct": "Rojo: dentro; Verde: fuera",
        "subject": "Abstracto",
        "id": "A021",
        "flag": false
    },
    {
        "question": "",
        "image": "https://i.imgur.com/Y3eIpcx.png",
        "options": [
            "7",
            "8",
            "9",
            "10"
        ],
        "correct": "10",
        "subject": "Abstracto",
        "id": "A022",
        "flag": false
    },
    {
        "question": "",
        "image": "https://i.imgur.com/JbmMAcy.png",
        "options": [
            "3",
            "5",
            "7",
            "9"
        ],
        "correct": "9",
        "subject": "Abstracto",
        "id": "A023",
        "flag": false
    },
    {
        "question": "",
        "image": "https://i.imgur.com/xOPKAHH.png",
        "options": [
            "Rojo: dentro; Verde: fuera",
            "Rojo: fuera; Verde: fuera",
            "Rojo: dentro; Verde: dentro",
            "Rojo fuera; Verde: dentro"
        ],
        "correct": "Rojo fuera; Verde: dentro",
        "subject": "Abstracto",
        "id": "A024",
        "flag": false
    },
    {
        "question": "",
        "image": "https://i.imgur.com/c1cNWfg.png",
        "options": [
            "Rojo: dentro; Verde: fuera",
            "Rojo: fuera; Verde: fuera",
            "Rojo: dentro; Verde: dentro",
            "Rojo fuera; Verde: dentro"
        ],
        "correct": "Rojo: dentro; Verde: fuera",
        "subject": "Abstracto",
        "id": "A025",
        "flag": false
    }
]

const questionsCurrent = [];
const boxButtons = document.querySelector("#box_buttons");
const boxQuestion = document.querySelector("#box_question");
const btnNavigate = document.querySelector("#btn_nav")
const h5Title = document.querySelector("#title");
const image = document.querySelector("#img");
const responses = [];
var posGlobal = 0;
//Timer
var upgradeTime = 1800;//1800
var seconds = upgradeTime;
var countdownTimer;
var urlmegapro = window.location.origin;

const partials = getRandoms(20);
console.log(questions.length);

for (let index = 0; index < partials.length; index++) {
    questionsCurrent.push(questions[partials[index]]);
}

boxButtons.innerHTML = "";
let index = 0;
for (const q of questionsCurrent) {
    boxButtons.innerHTML += `<button id="btn${index}" class="btn p-0 custom">${index + 1}</button>`;
    responses.push({
        "id": q.id,
        "response": ""
    })
    index++;
}

function renderQuestion(index) {
    const btnCurrent = document.querySelector(`#btn${posGlobal}`);
    btnCurrent.className = "btn p-0 checked"
    h5Title.innerHTML = `Razonamiento Abstracto - Pregunta ${posGlobal + 1} de 20`;
    boxQuestion.innerHTML = "";
    boxQuestion.innerHTML = `
    <p class="text-justify">${questionsCurrent[index].question}</p>
    <img src="${questionsCurrent[index].image}" alt="image"> 
    `;
    boxQuestion.innerHTML += renderOptions(questionsCurrent[index], index)
}

function renderOptions(question, index) {
    let html = "";
    let account = 0;
    for (const o of question.options) {
        html += `
        <div onclick="saveSelected('${o.toString()}', ${index}, 'radio${account}');" class="custom-control opt custom-radio border mb-1">
        <input type="radio" id="radio${account}" name="customRadio" class="custom-control-input opt">
        <label class="custom-control-label opt" style="width: 100%; height: 100%;"
            for="radio${account}">
            <p class="mb-0 opt">${o.toString()}</p>
        </label>
        </div>
        `
        account++;
    }
    return html;
}

function saveSelected(selected, index, radio) {
    change(radio);
    responses[index].response = selected.toString();
}

function change(id) {
    const radioCheked = document.querySelector(`#${id}`);
    radioCheked.checked = true;

}

btnNavigate.addEventListener("click", () => {
    if (posGlobal + 1 < responses.length) {
        const { response } = responses[posGlobal];
        const btnCurrent = document.querySelector(`#btn${posGlobal}`);
        if (response.toString() === "") {
            btnCurrent.className = "btn p-0 custom"
        } else {
            btnCurrent.className = "btn p-0 yes-response"
        }
        posGlobal = posGlobal + 1;
        if (posGlobal === (responses.length - 1)) {
            btnNavigate.innerHTML = "Terminar simulador!";
        }
        renderQuestion(posGlobal);
    } else {
        localStorage.setItem('megapro_res', JSON.stringify(responses));
        localStorage.setItem('megapro_ques', JSON.stringify(questionsCurrent));
        //window.location.href = urlmegapro + "/site/resultados.html";
        window.location.href = urlmegapro + "/resultados.html"
    }


});


renderQuestion(0);
renderImage();

function renderImage() {
    const random = getRandomArbitrary(1, 6);
    image.src = `./images/sim/${random}.jpeg`
}

function timer() {
    var days = Math.floor(seconds / 24 / 60 / 60);
    var hoursLeft = Math.floor((seconds) - (days * 86400));
    var hours = Math.floor(hoursLeft / 3600);
    var minutesLeft = Math.floor((hoursLeft) - (hours * 3600));
    var minutes = Math.floor(minutesLeft / 60);
    var remainingSeconds = seconds % 60;
    if (remainingSeconds < 10) {
        remainingSeconds = "0" + remainingSeconds;
    }
    if (minutes < 10) {
        minutes = "0" + minutes;
    }
    document.getElementById('timer').innerHTML = "";

    document.getElementById('timer').innerHTML = ' <strong> Tiempo: ' + hours + ":" + minutes + ":" + remainingSeconds + '</strong>';

    // if (seconds == 5390) {
    //     alert('En 10 minutos terminará el examen');
    // }

    if (seconds === 0) {
        clearInterval(countdownTimer);
        alert('El examen ha terminado!');
        window.location.href = urlmegapro + "/site/resultados.html";
    } else {
        seconds--;
    }
}

function getRandoms(size) {
    const numbers = [];
    for (let index = 0; index < size; index++) {
        let number = getRandomArbitrary(0, 23);
        while (numbers.includes(number)) {
            number = getRandomArbitrary(0, 23);
        }
        numbers.push(number);
    }
    return numbers;
}

function getRandomArbitrary(min, max) {
    return Math.trunc(Math.random() * (max - min) + min);
}

countdownTimer = setInterval('timer()', 1000);
